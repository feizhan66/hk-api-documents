##<span style="color:#2b7db0">刷卡支付</span>

#### 应用场景

收银员使用扫码设备读取微信用户刷卡授权码以后，二维码或条码信息传送至商户收银台，由商户收银台或者商户后台调用该接口发起支付。 

##### 提醒1：

提交支付请求后微信会同步返回支付结果。

当返回码为`40400`或`4006`时，商户系统等待5秒后调用【查询订单API】，查询支付实际交易结果；

当返回码为`201`时，商户系统可设置间隔时间(建议10秒)重新查询支付结果，直到支付成功或超时(建议30秒)； 
 
##### 提醒2：

在调用查询接口返回后，如果交易状况不明晰，请调用【撤销订单API】，此时如果交易失败则关闭订单，该单不能再支付成功；

如果交易成功，则将扣款退回到用户账户。当撤销无返回或错误时，请再次调用。注意：请勿调用扣款后立即调用【撤销订单API】，建议至少15s后再调用。  

#### 接口地址

api:

```
/wechat/payment/micropay
```

#### 接口参数
字段|变量名|必填|类型|描述
----|----|----|----|----
接口ID|appid|是|String(32)|由蓝海支付提供的接口应用ID
随机字符串|nonce_str|是|String(32)|随机字符串
签名|sign|是|String(32)|详情见签名规则
公众号ID|mp_appid|否|String(32)|如果需要在支付成功之后获取用户的openid这里为必填
终端设备号|device_info|否|String(32)|终端设备号(商户自定义，如门店编号)
商品描述|body|是|String(128)|商品或支付单简要描述
商品详情|detail|否|String(8192)|商品详细列表，使用Json格式，格式请参考【字段解释与规则】
附加数据|attach|否|String(127)|附加数据，在查询API和支付通知中原样返回，该字段主要用于商户携带订单的自定义数据
商户订单号|out_trade_no|是|String(32)|商户系统自定义订单号
标价金额|total_fee|是|Int|此处单位为港币最小单位分
终端IP|spbill_create_ip|是|String(16)|提交用户端ip
订单优惠标记|goods_tag|否|String(32)|商品标记，代金券或立减优惠功能的参数
微信授权码|auth_code|是|String(128)|微信授权码，（注：用户刷卡条形码规则：18位纯数字，以10、11、12、13、14、15开头）  |
场景信息|scene_info|否|String(256)|使用Json格式，格式请参考【字段解释与规则】

#### 返回结果
字段|变量名|必填|类型|描述
----|----|----|----|----
返回码|code|是|String(32)|返回码，请参考返回码表
返回信息|message|是|String(256)|返回信息，成功信息或错误信息
返回数据|data|否|Array/String|返回数据集或其他提示信息
  
###### 如果code=200,data参数：  
字段|变量名|必填|类型|描述
----|----|----|----|----
接口ID|appid|是|String(32)|由蓝海支付提供的接口应用ID
随机字符串|nonce_str|是|String(32)|随机字符串
签名|sign|是|String(32)|详情见签名规则
交易类型|trade_type|是|String(16)|交易类型为 JSAPI或NATIVE
付款银行|bank_type|是|String(16)|银行类型
现金支付金额|cash_fee|是|Int|订单现金支付金额
现金支付币种|cash\_fee_type|是|String(16)|现金支付的币种，默认为人民币
商户订单号|out\_trade_no|是|String(32)|商户系统自定义的订单号
微信支付订单号|transaction_id|是|String(32)|微信支付订单号
标价币种|fee_type|否|String(16)|标价币种
标价金额|total_fee|是|Int|标价金额
支付完成时间|time_end|是|String(14)|支付完成时间时间格式为YYYYMMDDHHmmss
用户标识|openid|否|String(128)|用户标识
是否关注公众号|is_subscribe|否|String(1)|是否关注了公众号
设备号|device_info|否|String(32)|设备号
商家数据包|attach|否|String(128)|商家数据包，原样返回